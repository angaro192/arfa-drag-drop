import { Component, EventEmitter, Input, Output, } from '@angular/core';
import { catchError, take, throwError } from 'rxjs';
import * as i0 from "@angular/core";
import * as i1 from "./services/helpersService.service";
import * as i2 from "@angular/common";
export class ArfaDragDropComponent {
    constructor(cd, helpersService) {
        this.cd = cd;
        this.helpersService = helpersService;
        this.attachments = [];
        this.multiple = false;
        this.limit = 999;
        this.newItemEvent = new EventEmitter();
    }
    ngOnInit() { }
    addNewItem(value) {
        this.newItemEvent.emit(value);
    }
    onFileDropped($event, arrayFiles, limit = null) {
        this.prepareFilesList($event, arrayFiles, limit);
    }
    fileBrowseHandler(files, arrayFiles, limit = null) {
        this.prepareFilesList(files, arrayFiles, limit);
    }
    deleteFile(index, arrayFiles) {
        arrayFiles.splice(index, 1);
        this.cd.detectChanges();
    }
    prepareFilesList(files, arrayFiles, limit = null) {
        this.onSelectFile(files, arrayFiles, limit);
    }
    onSelectFile(e, arrayFiles, limit = null) {
        Array.prototype.forEach.call(e.target.files, (file) => {
            const pattern = /image-*/;
            if (!file || !file.type.match(pattern)) {
                return;
            }
            const maxAvatarImage = 8;
            if (Math.round(file.size / 1024) >= maxAvatarImage * 1000) {
                return;
            }
            this.helpersService
                .compress(file, 425, 96)
                .pipe(take(1), catchError((event) => {
                return throwError(event);
            }))
                .subscribe((response) => {
                const reader = new FileReader();
                reader.readAsDataURL(response);
                reader.onload = () => {
                    const fileObject = {
                        nameTypeFile: this.nameTypeFile,
                        fileName: file.name,
                        file: reader.result,
                    };
                    if (limit != null) {
                        if (arrayFiles.length < limit) {
                            arrayFiles.push(fileObject);
                            this.addNewItem(fileObject);
                        }
                    }
                    else {
                        arrayFiles.push(fileObject);
                    }
                    this.cd.detectChanges();
                };
            });
        });
    }
}
ArfaDragDropComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.2.5", ngImport: i0, type: ArfaDragDropComponent, deps: [{ token: i0.ChangeDetectorRef }, { token: i1.HelpersService }], target: i0.ɵɵFactoryTarget.Component });
ArfaDragDropComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.2.5", type: ArfaDragDropComponent, selector: "lib-arfa-drag-drop", inputs: { attachments: "attachments", name: "name", messageDragDrop: "messageDragDrop", nameTypeFile: "nameTypeFile", multiple: "multiple", limit: "limit" }, outputs: { newItemEvent: "newItemEvent" }, ngImport: i0, template: "<label class=\"label-dragdrop\">{{name}}</label>\n<div id=\"fileUploadFoto\">\n  <div class=\"ds-drod-container border\" appDnd (fileDropped)=\"onFileDropped($event, attachments, limit)\">\n    <input placeholder=\"...\" type=\"file\" #newItem [multiple]=\"multiple\" (change)=\"fileBrowseHandler($event, attachments,limit)\" />\n    <i class=\"fas fa-cloud-upload-alt fa-3x\" class=\"ds-colorSpan\"></i> <br />\n    <span *ngIf=\"messageDragDrop\" class=\"ds-colorSpan\">{{messageDragDrop}}</span>\n  </div>\n  <div class=\"files-list\">\n    <div class=\"single-file m-0\" *ngFor=\"let attachment of attachments; let i = index\">\n      <i class=\"fas fa-file\" class=\"ds-colorSpan\"></i>\n      <div class=\"info\">\n        <h4 class=\"name mx-2\">\n          {{ attachment?.fileName }}\n        </h4>\n      </div>\n      <i class=\"fas fa-trash delete\" (click)=\"deleteFile(i, attachments)\"></i>\n    </div>\n  </div>\n</div>\n", styles: ["input::-webkit-outer-spin-button,input::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number]{-webkit-appearance:textfield}.ds-colorSpan{color:#c6c6c6}.mat-stepper-horizontal{margin-top:8px}.mat-form-field{margin-top:16px}.label-dragdrop{color:#958e8e;margin-bottom:.5rem;margin-top:.5rem}::ng-deep .mat-step-header .mat-step-icon-selected{background-color:#c4c4c4}::ng-deep .mat-step-header .mat-step-icon-state-edit{background-color:#0aa71a}::ng-deep .mat-step-icon{height:34px!important;width:34px!important}::ng-deep .mat-step-label.mat-step-label{text-overflow:inherit!important;white-space:normal!important}.files input{outline-offset:-10px;transition:outline-offset .15s ease-in-out,background-color .15s linear;padding:120px 0 85px 35%;text-align:center!important;margin:0;width:100%!important}.files input:focus{outline-offset:-10px;transition:outline-offset .15s ease-in-out,background-color .15s linear;border:1px solid #92b0b3}.files{position:relative}.files:after{pointer-events:none;position:absolute;top:60px;left:0;width:50px;right:0;height:56px;content:\"\";display:block;margin:0 auto;background-size:100%;background-repeat:no-repeat}.color input{background-color:#f1f1f1}.files:before{position:absolute;bottom:10px;left:0;pointer-events:none;width:100%;right:0;height:57px;content:\" [Arraste ou clique para anexar]. \";display:block;margin:0 auto;color:#c6c6c6;font-weight:600;text-transform:capitalize;text-align:center}.file-drop-area{position:relative;display:flex;align-items:center;width:450px;max-width:100%;padding:25px;border:1px dashed rgba(233,23,23,.4);border-radius:3px;transition:.2s}.choose-file-button{flex-shrink:0;background-color:#ffffff0a;border:1px solid rgba(255,255,255,.1);border-radius:3px;padding:8px 15px;margin-right:10px;font-size:12px;text-transform:uppercase}.file-message{font-size:small;font-weight:300;line-height:1.4;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.file-input{position:absolute;left:0;top:0;height:100%;width:100%;cursor:pointer;opacity:0}.mt-100{margin-top:100px}.ds-drod-container{padding:3rem;text-align:center;position:relative;margin:0 auto}.ds-drod-container input{opacity:0;position:absolute;z-index:2;width:100%;height:100%;top:0;left:0;cursor:pointer}.ds-drod-container label{color:#fff;width:183px;height:44px;border-radius:21.5px;background-color:#db202f;padding:8px 16px}.ds-drod-container h3{font-size:20px;font-weight:600;color:#38424c}.fileover{animation:shake 1s;animation-iteration-count:infinite}.files-list{margin-top:.5rem}.files-list .single-file{padding:.5rem;justify-content:space-between;align-items:center;margin-bottom:1rem;display:flex;flex-grow:1}.files-list .single-file img.delete{margin-left:.5rem;cursor:pointer;align-self:flex-end}.files-list .single-file i.delete{margin-left:.5rem;cursor:pointer;color:red}.files-list .single-file .name{font-size:14px;font-weight:500;color:#353f4a;margin:0}.files-list .single-file .size{font-size:12px;font-weight:500;color:#a4a4a4;margin:0;margin-bottom:.25rem}.files-list .single-file .info{width:100%}.ds-message-file{position:absolute;bottom:0;right:0}\n"], directives: [{ type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i2.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.2.5", ngImport: i0, type: ArfaDragDropComponent, decorators: [{
            type: Component,
            args: [{ selector: 'lib-arfa-drag-drop', template: "<label class=\"label-dragdrop\">{{name}}</label>\n<div id=\"fileUploadFoto\">\n  <div class=\"ds-drod-container border\" appDnd (fileDropped)=\"onFileDropped($event, attachments, limit)\">\n    <input placeholder=\"...\" type=\"file\" #newItem [multiple]=\"multiple\" (change)=\"fileBrowseHandler($event, attachments,limit)\" />\n    <i class=\"fas fa-cloud-upload-alt fa-3x\" class=\"ds-colorSpan\"></i> <br />\n    <span *ngIf=\"messageDragDrop\" class=\"ds-colorSpan\">{{messageDragDrop}}</span>\n  </div>\n  <div class=\"files-list\">\n    <div class=\"single-file m-0\" *ngFor=\"let attachment of attachments; let i = index\">\n      <i class=\"fas fa-file\" class=\"ds-colorSpan\"></i>\n      <div class=\"info\">\n        <h4 class=\"name mx-2\">\n          {{ attachment?.fileName }}\n        </h4>\n      </div>\n      <i class=\"fas fa-trash delete\" (click)=\"deleteFile(i, attachments)\"></i>\n    </div>\n  </div>\n</div>\n", styles: ["input::-webkit-outer-spin-button,input::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number]{-webkit-appearance:textfield}.ds-colorSpan{color:#c6c6c6}.mat-stepper-horizontal{margin-top:8px}.mat-form-field{margin-top:16px}.label-dragdrop{color:#958e8e;margin-bottom:.5rem;margin-top:.5rem}::ng-deep .mat-step-header .mat-step-icon-selected{background-color:#c4c4c4}::ng-deep .mat-step-header .mat-step-icon-state-edit{background-color:#0aa71a}::ng-deep .mat-step-icon{height:34px!important;width:34px!important}::ng-deep .mat-step-label.mat-step-label{text-overflow:inherit!important;white-space:normal!important}.files input{outline-offset:-10px;transition:outline-offset .15s ease-in-out,background-color .15s linear;padding:120px 0 85px 35%;text-align:center!important;margin:0;width:100%!important}.files input:focus{outline-offset:-10px;transition:outline-offset .15s ease-in-out,background-color .15s linear;border:1px solid #92b0b3}.files{position:relative}.files:after{pointer-events:none;position:absolute;top:60px;left:0;width:50px;right:0;height:56px;content:\"\";display:block;margin:0 auto;background-size:100%;background-repeat:no-repeat}.color input{background-color:#f1f1f1}.files:before{position:absolute;bottom:10px;left:0;pointer-events:none;width:100%;right:0;height:57px;content:\" [Arraste ou clique para anexar]. \";display:block;margin:0 auto;color:#c6c6c6;font-weight:600;text-transform:capitalize;text-align:center}.file-drop-area{position:relative;display:flex;align-items:center;width:450px;max-width:100%;padding:25px;border:1px dashed rgba(233,23,23,.4);border-radius:3px;transition:.2s}.choose-file-button{flex-shrink:0;background-color:#ffffff0a;border:1px solid rgba(255,255,255,.1);border-radius:3px;padding:8px 15px;margin-right:10px;font-size:12px;text-transform:uppercase}.file-message{font-size:small;font-weight:300;line-height:1.4;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.file-input{position:absolute;left:0;top:0;height:100%;width:100%;cursor:pointer;opacity:0}.mt-100{margin-top:100px}.ds-drod-container{padding:3rem;text-align:center;position:relative;margin:0 auto}.ds-drod-container input{opacity:0;position:absolute;z-index:2;width:100%;height:100%;top:0;left:0;cursor:pointer}.ds-drod-container label{color:#fff;width:183px;height:44px;border-radius:21.5px;background-color:#db202f;padding:8px 16px}.ds-drod-container h3{font-size:20px;font-weight:600;color:#38424c}.fileover{animation:shake 1s;animation-iteration-count:infinite}.files-list{margin-top:.5rem}.files-list .single-file{padding:.5rem;justify-content:space-between;align-items:center;margin-bottom:1rem;display:flex;flex-grow:1}.files-list .single-file img.delete{margin-left:.5rem;cursor:pointer;align-self:flex-end}.files-list .single-file i.delete{margin-left:.5rem;cursor:pointer;color:red}.files-list .single-file .name{font-size:14px;font-weight:500;color:#353f4a;margin:0}.files-list .single-file .size{font-size:12px;font-weight:500;color:#a4a4a4;margin:0;margin-bottom:.25rem}.files-list .single-file .info{width:100%}.ds-message-file{position:absolute;bottom:0;right:0}\n"] }]
        }], ctorParameters: function () { return [{ type: i0.ChangeDetectorRef }, { type: i1.HelpersService }]; }, propDecorators: { attachments: [{
                type: Input
            }], name: [{
                type: Input
            }], messageDragDrop: [{
                type: Input
            }], nameTypeFile: [{
                type: Input
            }], multiple: [{
                type: Input
            }], limit: [{
                type: Input
            }], newItemEvent: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXJmYS1kcmFnLWRyb3AuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvYXJmYS1kcmFnLWRyb3Avc3JjL2xpYi9hcmZhLWRyYWctZHJvcC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9wcm9qZWN0cy9hcmZhLWRyYWctZHJvcC9zcmMvbGliL2FyZmEtZHJhZy1kcm9wLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFFTCxTQUFTLEVBQ1QsWUFBWSxFQUNaLEtBQUssRUFFTCxNQUFNLEdBQ1AsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLE1BQU0sTUFBTSxDQUFDOzs7O0FBUXBELE1BQU0sT0FBTyxxQkFBcUI7SUFVaEMsWUFDVSxFQUFxQixFQUNyQixjQUE4QjtRQUQ5QixPQUFFLEdBQUYsRUFBRSxDQUFtQjtRQUNyQixtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFYL0IsZ0JBQVcsR0FBVSxFQUFFLENBQUM7UUFJeEIsYUFBUSxHQUFHLEtBQUssQ0FBQztRQUNqQixVQUFLLEdBQUcsR0FBRyxDQUFDO1FBRVgsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBUyxDQUFDO0lBS2hELENBQUM7SUFFSixRQUFRLEtBQVUsQ0FBQztJQUVuQixVQUFVLENBQUMsS0FBVTtRQUNuQixJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNoQyxDQUFDO0lBRUQsYUFBYSxDQUFDLE1BQU0sRUFBRSxVQUFpQixFQUFFLFFBQWdCLElBQUk7UUFDM0QsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sRUFBRSxVQUFVLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDbkQsQ0FBQztJQUVELGlCQUFpQixDQUFDLEtBQUssRUFBRSxVQUFpQixFQUFFLFFBQWdCLElBQUk7UUFDOUQsSUFB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aW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgRXZlbnRFbWl0dGVyLFxuICBJbnB1dCxcbiAgT25Jbml0LFxuICBPdXRwdXQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgY2F0Y2hFcnJvciwgdGFrZSwgdGhyb3dFcnJvciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgSGVscGVyc1NlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2VzL2hlbHBlcnNTZXJ2aWNlLnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdsaWItYXJmYS1kcmFnLWRyb3AnLFxuICB0ZW1wbGF0ZVVybDogJy4vYXJmYS1kcmFnLWRyb3AuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9hcmZhLWRyYWctZHJvcC5jb21wb25lbnQuc2NzcyddLFxufSlcbmV4cG9ydCBjbGFzcyBBcmZhRHJhZ0Ryb3BDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICBASW5wdXQoKSBhdHRhY2htZW50czogYW55W10gPSBbXTtcbiAgQElucHV0KCkgbmFtZTogc3RyaW5nO1xuICBASW5wdXQoKSBtZXNzYWdlRHJhZ0Ryb3A6IHN0cmluZztcbiAgQElucHV0KCkgbmFtZVR5cGVGaWxlOiBzdHJpbmc7XG4gIEBJbnB1dCgpIG11bHRpcGxlID0gZmFsc2U7XG4gIEBJbnB1dCgpIGxpbWl0ID0gOTk5O1xuXG4gIEBPdXRwdXQoKSBuZXdJdGVtRXZlbnQgPSBuZXcgRXZlbnRFbWl0dGVyPGFueVtdPigpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmLFxuICAgIHByaXZhdGUgaGVscGVyc1NlcnZpY2U6IEhlbHBlcnNTZXJ2aWNlXG4gICkge31cblxuICBuZ09uSW5pdCgpOiB2b2lkIHt9XG5cbiAgYWRkTmV3SXRlbSh2YWx1ZTogYW55KSB7XG4gICAgdGhpcy5uZXdJdGVtRXZlbnQuZW1pdCh2YWx1ZSk7XG4gIH1cblxuICBvbkZpbGVEcm9wcGVkKCRldmVudCwgYXJyYXlGaWxlczogYW55W10sIGxpbWl0OiBudW1iZXIgPSBudWxsKSB7XG4gICAgdGhpcy5wcmVwYXJlRmlsZXNMaXN0KCRldmVudCwgYXJyYXlGaWxlcywgbGltaXQpO1xuICB9XG5cbiAgZmlsZUJyb3dzZUhhbmRsZXIoZmlsZXMsIGFycmF5RmlsZXM6IGFueVtdLCBsaW1pdDogbnVtYmVyID0gbnVsbCkge1xuICAgIHRoaXMucHJlcGFyZUZpbGVzTGlzdChmaWxlcywgYXJyYXlGaWxlcywgbGltaXQpO1xuICB9XG5cbiAgZGVsZXRlRmlsZShpbmRleDogbnVtYmVyLCBhcnJheUZpbGVzOiBhbnlbXSkge1xuICAgIGFycmF5RmlsZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcbiAgfVxuXG4gIHByZXBhcmVGaWxlc0xpc3QoZmlsZXM6IGFueSwgYXJyYXlGaWxlczogYW55W10sIGxpbWl0OiBudW1iZXIgPSBudWxsKSB7XG4gICAgdGhpcy5vblNlbGVjdEZpbGUoZmlsZXMsIGFycmF5RmlsZXMsIGxpbWl0KTtcbiAgfVxuXG4gIG9uU2VsZWN0RmlsZShlOiBhbnksIGFycmF5RmlsZXM6IGFueVtdLCBsaW1pdDogbnVtYmVyID0gbnVsbCkge1xuICAgIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwoZS50YXJnZXQuZmlsZXMsIChmaWxlKSA9PiB7XG4gICAgICBjb25zdCBwYXR0ZXJuID0gL2ltYWdlLSovO1xuICAgICAgaWYgKCFmaWxlIHx8ICFmaWxlLnR5cGUubWF0Y2gocGF0dGVybikpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBtYXhBdmF0YXJJbWFnZSA9IDg7XG4gICAgICBpZiAoTWF0aC5yb3VuZChmaWxlLnNpemUgLyAxMDI0KSA+PSBtYXhBdmF0YXJJbWFnZSAqIDEwMDApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmhlbHBlcnNTZXJ2aWNlXG4gICAgICAgIC5jb21wcmVzcyhmaWxlLCA0MjUsIDk2KVxuICAgICAgICAucGlwZShcbiAgICAgICAgICB0YWtlKDEpLFxuICAgICAgICAgIGNhdGNoRXJyb3IoKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhyb3dFcnJvcihldmVudCk7XG4gICAgICAgICAgfSlcbiAgICAgICAgKVxuICAgICAgICAuc3Vic2NyaWJlKChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwocmVzcG9uc2UpO1xuICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBmaWxlT2JqZWN0ID0ge1xuICAgICAgICAgICAgICBuYW1lVHlwZUZpbGU6IHRoaXMubmFtZVR5cGVGaWxlLFxuICAgICAgICAgICAgICBmaWxlTmFtZTogZmlsZS5uYW1lLFxuICAgICAgICAgICAgICBmaWxlOiByZWFkZXIucmVzdWx0IGFzIHN0cmluZyxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAobGltaXQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICBpZiAoYXJyYXlGaWxlcy5sZW5ndGggPCBsaW1pdCkge1xuICAgICAgICAgICAgICAgIGFycmF5RmlsZXMucHVzaChmaWxlT2JqZWN0KTtcbiAgICAgICAgICAgICAgICB0aGlzLmFkZE5ld0l0ZW0oZmlsZU9iamVjdCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGFycmF5RmlsZXMucHVzaChmaWxlT2JqZWN0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICB9XG59XG4iLCI8bGFiZWwgY2xhc3M9XCJsYWJlbC1kcmFnZHJvcFwiPnt7bmFtZX19PC9sYWJlbD5cbjxkaXYgaWQ9XCJmaWxlVXBsb2FkRm90b1wiPlxuICA8ZGl2IGNsYXNzPVwiZHMtZHJvZC1jb250YWluZXIgYm9yZGVyXCIgYXBwRG5kIChmaWxlRHJvcHBlZCk9XCJvbkZpbGVEcm9wcGVkKCRldmVudCwgYXR0YWNobWVudHMsIGxpbWl0KVwiPlxuICAgIDxpbnB1dCBwbGFjZWhvbGRlcj1cIi4uLlwiIHR5cGU9XCJmaWxlXCIgI25ld0l0ZW0gW211bHRpcGxlXT1cIm11bHRpcGxlXCIgKGNoYW5nZSk9XCJmaWxlQnJvd3NlSGFuZGxlcigkZXZlbnQsIGF0dGFjaG1lbnRzLGxpbWl0KVwiIC8+XG4gICAgPGkgY2xhc3M9XCJmYXMgZmEtY2xvdWQtdXBsb2FkLWFsdCBmYS0zeFwiIGNsYXNzPVwiZHMtY29sb3JTcGFuXCI+PC9pPiA8YnIgLz5cbiAgICA8c3BhbiAqbmdJZj1cIm1lc3NhZ2VEcmFnRHJvcFwiIGNsYXNzPVwiZHMtY29sb3JTcGFuXCI+e3ttZXNzYWdlRHJhZ0Ryb3B9fTwvc3Bhbj5cbiAgPC9kaXY+XG4gIDxkaXYgY2xhc3M9XCJmaWxlcy1saXN0XCI+XG4gICAgPGRpdiBjbGFzcz1cInNpbmdsZS1maWxlIG0tMFwiICpuZ0Zvcj1cImxldCBhdHRhY2htZW50IG9mIGF0dGFjaG1lbnRzOyBsZXQgaSA9IGluZGV4XCI+XG4gICAgICA8aSBjbGFzcz1cImZhcyBmYS1maWxlXCIgY2xhc3M9XCJkcy1jb2xvclNwYW5cIj48L2k+XG4gICAgICA8ZGl2IGNsYXNzPVwiaW5mb1wiPlxuICAgICAgICA8aDQgY2xhc3M9XCJuYW1lIG14LTJcIj5cbiAgICAgICAgICB7eyBhdHRhY2htZW50Py5maWxlTmFtZSB9fVxuICAgICAgICA8L2g0PlxuICAgICAgPC9kaXY+XG4gICAgICA8aSBjbGFzcz1cImZhcyBmYS10cmFzaCBkZWxldGVcIiAoY2xpY2spPVwiZGVsZXRlRmlsZShpLCBhdHRhY2htZW50cylcIj48L2k+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuPC9kaXY+XG4iXX0=